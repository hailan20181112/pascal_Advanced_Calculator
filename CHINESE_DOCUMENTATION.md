# 高级计算器项目文档

## 项目概述
本项目是使用Free Pascal和Lazarus IDE开发的高级计算器应用程序。它提供了用户友好的界面和各种数学函数，包括基本算术运算、三角函数、对数函数等。

## 功能特点
- 基本算术运算（加、减、乘、除）
- 科学函数（正弦、余弦、正切、对数、自然对数、指数等）
- 内存功能（MC、MR、MS、M+、M-）
- 历史记录查看
- 角度模式切换（角度制/弧度制）
- 错误处理和输入验证

## 项目结构
- **project1.lpr**: 主项目文件
- **unit1.pas**: 包含所有计算器逻辑和UI事件处理程序的主单元
- **unit1.lfm**: 窗体设计文件
- **project1.ico**: 应用程序图标
- **project1.res**: 资源文件

## 技术细节

### 代码结构

#### 主窗体 (TForm1)
主窗体是应用程序的核心组件，包含所有UI元素并处理所有用户交互。

#### 类变量
- `FMemory`: 存储内存操作的值 (MC, MR, MS, M+, M-)
- `FHistory`: 存储计算历史的TStringList对象
- `FCurrentOp`: 当前执行的操作
- `FOperand`: 二元操作中的第一个操作数
- `FIsNewInput`: 指示下一个数字是否应该开始新输入的标志
- `FIsDegree`: 指示角度测量是否为角度制的标志

#### UI组件
- `EditDisplay`: 显示当前输入或结果的主显示区
- `LabelHistory`: 显示最后一次计算的标签
- `ListHistory`: 显示计算历史的列表框
- 数字按钮 (0-9, 00, .)
- 运算按钮 (+, -, ×, ÷)
- 函数按钮 (sin, cos, tan, log, ln等)
- 内存按钮 (MC, MR, MS, M+, M-)
- 控制按钮 (AC, CE, ⌫)

#### 关键方法

##### 初始化和清理
- `FormCreate`: 初始化变量、对象和UI
- `FormDestroy`: 释放分配的资源

##### 输入处理
- `ButtonNumClick`: 处理数字按钮点击
- `ButtonDotClick`: 处理小数点按钮点击
- `ButtonBackClick`: 处理退格按钮点击
- `ButtonSignClick`: 处理符号更改按钮点击

##### 运算处理
- `ButtonOpClick`: 处理运算按钮点击
- `ButtonEqClick`: 计算并显示结果

##### 函数处理
- `ButtonSqrtClick`: 计算平方根
- `ButtonXSqClick`: 计算平方
- `ButtonFactClick`: 计算阶乘
- `ButtonSinClick`: 计算正弦
- `ButtonCosClick`: 计算余弦
- `ButtonTanClick`: 计算正切
- `ButtonLogClick`: 计算以10为底的对数
- `ButtonLnClick`: 计算自然对数
- `ButtonExpClick`: 计算指数函数
- `ButtonAbsClick`: 计算绝对值
- `ButtonInvClick`: 计算倒数
- `ButtonPercentClick`: 计算百分比

##### 内存处理
- `ButtonMemoryClick`: 处理所有内存操作 (MC, MR, MS, M+, M-)

##### UI管理
- `ButtonACClick`: 清除所有输入和内存
- `ButtonCEClick`: 清除当前输入
- `ButtonDegRadClick`: 在角度制和弧度制之间切换
- `ButtonHistoryClick`: 显示/隐藏计算历史
- `AddToHistory`: 将计算添加到历史记录
- `UpdateDisplay`: 用新值更新显示

### 实现细节

#### 错误处理
所有数学运算都包含全面的错误检查：
- 使用`TryStrToFloat`进行输入验证，确保有效的数字输入
- 范围检查以防止溢出/下溢
- 对具有受限域的函数进行域检查（例如，对数、平方根）
- 使用`IsNan`和`IsInfinite`进行结果验证，检测无效结果

#### 内存管理
- 内存在启动时初始化为0
- 内存操作通过单一方法（`ButtonMemoryClick`）处理
- 计算之间保留内存值

#### 历史记录管理
- 历史记录存储在TStringList对象中
- 新计算添加到历史列表的顶部
- 历史列表限制为50个条目，以防止过度内存使用
- 可以通过切换按钮查看/隐藏历史记录

#### UI设计
- 紧凑布局，最小间距
- 按钮颜色编码，提高可用性
- 显示/隐藏历史记录时动态调整窗口大小
- 对无效操作提供清晰的错误消息

## 用户指南

### 开始使用
1. 双击`project1.exe`文件启动应用程序。
2. 计算器将打开，显示屏显示"0"。
3. 您可以立即开始输入数字并执行计算。

### 基本操作

#### 输入数字
- 点击数字按钮(0-9)输入数字。
- 使用"00"按钮快速输入两个零。
- 使用"."按钮输入小数点。
- 使用"+/-"按钮更改当前数字的符号。

#### 算术运算
- 加法(+)：输入第一个数字，点击"+"，输入第二个数字，然后点击"="。
- 减法(-)：输入第一个数字，点击"-"，输入第二个数字，然后点击"="。
- 乘法(×)：输入第一个数字，点击"×"，输入第二个数字，然后点击"="。
- 除法(÷)：输入第一个数字，点击"÷"，输入第二个数字，然后点击"="。
- 幂运算(xʸ)：输入底数，点击"xʸ"，输入指数，然后点击"="。

#### 清除和修正
- "AC"(全部清除)：清除所有输入和内存。
- "CE"(清除输入)：仅清除当前输入。
- "⌫"(退格)：删除最后输入的数字。

### 科学函数

#### 三角函数
- "sin"：计算显示值的正弦。
- "cos"：计算显示值的余弦。
- "tan"：计算显示值的正切。
- "角度制"：在角度制和弧度制之间切换，用于三角计算。

#### 对数和指数函数
- "log"：计算显示值的以10为底的对数。
- "ln"：计算显示值的自然对数(以e为底)。
- "eˣ"：计算e的显示值次方。

#### 其他函数
- "√"：计算显示值的平方根。
- "x²"：计算显示值的平方。
- "n!"：计算显示值的阶乘。
- "|x|"：计算显示值的绝对值。
- "1/x"：计算显示值的倒数。
- "%"：将显示值转换为百分比(除以100)。

### 内存功能
- "MC"(内存清除)：清除内存。
- "MR"(内存调用)：调用存储在内存中的值。
- "MS"(内存存储)：将显示值存储在内存中。
- "M+"(内存加)：将显示值加到内存中。
- "M-"(内存减)：从内存中减去显示值。

### 历史功能
- "查看历史记录"：显示或隐藏计算历史。
- 历史记录显示当前会话中执行的所有计算。
- 最近的计算显示在列表的顶部。

### 错误处理
计算器在以下情况下会显示错误消息：
- 除以零
- 对零或负数取对数
- 对负数开平方根
- 计算负数的阶乘
- 输入无效(非数字字符)
- 会导致溢出的计算

## 安装和编译

### 安装要求
- Lazarus IDE (推荐版本 2.0.0 或更高)
- Free Pascal Compiler (推荐版本 3.0.4 或更高)

### 编译步骤
1. 在Lazarus IDE中打开项目文件 `project1.lpi`
2. 选择 "运行" > "编译" 或按 F9 键编译项目
3. 编译成功后，可执行文件 `project1.exe` 将在项目目录中生成

### 运行应用程序
- 双击 `project1.exe` 文件运行应用程序
- 或在Lazarus IDE中选择 "运行" > "运行" 或按 F9 键运行应用程序
